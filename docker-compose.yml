services:
  c02:
    build:
      context: .
      dockerfile: c02-jms-broker/Dockerfile
    image: dad-c02
    container_name: c02
    ports:
      - "61616:61616"

  c04:
    build:
      context: .
      dockerfile: c04-rmi-server/Dockerfile
    image: dad-c04
    container_name: c04
    ports:
      - "8084:8080"
      - "1094:1099"
    depends_on:
      - c02

  c05:
    build:
      context: .
      dockerfile: c05-rmi-server/Dockerfile
    image: dad-c05
    container_name: c05
    ports:
      - "8085:8080"
      - "1095:1099"
    depends_on:
      - c02

  c06:
    build:
      context: .
      dockerfile: c06-node-db/Dockerfile
    image: dad-c06
    container_name: c06
    ports:
      - "3000:3000"
    environment:
      MYSQL_HOST: localhost
      MYSQL_USER: root
      MYSQL_PASSWORD: ""
      MYSQL_DB: bmpdb
      MONGO_URL: mongodb://localhost:27017
      MONGO_DB: snmpdb
      C06_PUBLIC_URL: http://localhost:3000

  c03:
    build:
      context: .
      dockerfile: c03-mdb-rmi-client/Dockerfile
    image: dad-c03
    container_name: c03
    ports:
      - "8083:8080"
    environment:
      JMS_BROKER_HOST: c02
      JMS_BROKER_PORT: "61616"
      c04.host: c04
      c05.host: c05
      c06.url: http://c06:3000
      c01.url: http://c01:7000
    depends_on:
      c02:
        condition: service_started
      c04:
        condition: service_started
      c05:
        condition: service_started
      c06:
        condition: service_started

  c01:
    build:
      context: .
      dockerfile: c01-backend/Dockerfile
    image: dad-c01
    container_name: c01
    ports:
      - "7000:7000"
    environment:
      JMS_URL: "failover:(tcp://c02:61616)?initialReconnectDelay=1000&maxReconnectDelay=30000&useExponentialBackOff=true"
    depends_on:
      - c02
    healthcheck:
      test: ["CMD-SHELL", "wget -q -O - http://localhost:7000/health || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 15
      start_period: 30s

  frontend:
    build:
      context: frontend
      dockerfile: Dockerfile
    image: dad-frontend
    container_name: frontend
    ports:
      - "5173:5173"
    depends_on:
      - c01

networks:
  default:
    name: dad-net
